<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Salt City Grid</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1 class="glitch">Salt City Grid</h1>
        <p class="flavor-text">"The toxic dust clouds are bad for health, but great for Healthcareâ„¢ shareholders."</p>

        <div class="events-container">
            <section>
                <h2>Past AlwaysBeRunning Events</h2>
                <div id="abr-past-events" class="event-list"></div>
            </section>

            <section>
                <h2>Upcoming AlwaysBeRunning Events</h2>
                <div id="abr-upcoming-events" class="event-list"></div>
            </section>

            <section>
                <h2>Past COBRA Tournaments</h2>
                <div id="cobra-past-events" class="event-list"></div>
            </section>

            <section>
                <h2>Upcoming COBRA Tournaments</h2>
                <div id="cobra-upcoming-events" class="event-list"></div>
            </section>
        </div>
    </div>

    <!-- Template for event items -->
    <template id="event-template">
        <div class="event">
            <h3><a class="event-title" target="_blank"></a></h3>
            <p><strong>Date:</strong> <span class="event-date"></span></p>
            <p><strong>Organizer:</strong> <span class="event-organizer"></span></p>
            <p><strong>Players:</strong> <span class="event-players"></span></p>
        </div>
    </template>

    <script>
        document.addEventListener("DOMContentLoaded", () => {
            loadEvents("abr_data.json", "abr-past-events", "abr-upcoming-events", formatABREvent);
            loadEvents("cobra_tournaments.json", "cobra-past-events", "cobra-upcoming-events", formatCobraTournament);
        });

        async function loadEvents(jsonFile, pastContainerId, upcomingContainerId, formatter) {
            try {
                const response = await fetch(jsonFile);
                if (!response.ok) throw new Error("Failed to load " + jsonFile);
                const events = await response.json();

                const pastContainer = document.getElementById(pastContainerId);
                const upcomingContainer = document.getElementById(upcomingContainerId);

                // Clear previous content
                pastContainer.innerHTML = "";
                upcomingContainer.innerHTML = "";

                // Get today's date for filtering
                const today = new Date().toISOString().split("T")[0];

                const pastEvents = events.filter(event => event.date < today);
                const upcomingEvents = events.filter(event => event.date >= today);

                // Sort past events (most recent first)
                pastEvents.sort((a, b) => b.date.localeCompare(a.date));

                // Sort upcoming events (soonest first)
                upcomingEvents.sort((a, b) => a.date.localeCompare(b.date));

                // Display past events
                if (pastEvents.length > 0) {
                    pastEvents.forEach(event => pastContainer.appendChild(formatter(event)));
                } else {
                    pastContainer.innerHTML = "<p>No past events found.</p>";
                }

                // Display upcoming events
                if (upcomingEvents.length > 0) {
                    upcomingEvents.forEach(event => upcomingContainer.appendChild(formatter(event)));
                } else {
                    upcomingContainer.innerHTML = "<p>No upcoming events found.</p>";
                }
            } catch (error) {
                console.error("Error loading events:", error);
            }
        }

        function formatABREvent(event) {
            return createEventElement(event, event.url, event.title, event.date.replace(/\./g, '-'), event.creator_name, event.players_count);
        }

        function formatCobraTournament(event) {
            return createEventElement(event, event.url, event.title, event.date, event.tournament_organizer, event.player_count);
        }

        function createEventElement(event, url, title, date, organizer, players) {
            const template = document.getElementById("event-template");
            const eventElement = template.content.cloneNode(true);

            eventElement.querySelector(".event-title").href = url;
            eventElement.querySelector(".event-title").textContent = title;
            eventElement.querySelector(".event-date").textContent = date;
            eventElement.querySelector(".event-organizer").textContent = organizer;
            eventElement.querySelector(".event-players").textContent = players;

            return eventElement;
        }
    </script>
</body>
</html>
